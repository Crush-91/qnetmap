\documentclass[12pt]{article}

\usepackage[cp1251]{inputenc}
\usepackage[russian]{babel} 
\usepackage{graphicx} 
\usepackage{array}
\usepackage{longtable} 
\usepackage[centerlast,small]{caption2}
\usepackage{url}
\usepackage{textcomp}

\oddsidemargin=0pt
\textwidth=182mm
\topmargin=-25mm
\textheight=250mm
\sloppy

\renewcommand{\captionlabeldelim}{.}

\title{Описание формата XML файла библиотеки qnetmap} 
\author{С.П. Шумейко ({\tt sergey.shumeyko@gmail.com})}
% Чтобы не писалась текущая дата
\date{}

%========================================================================
\begin{document}

\maketitle

%========================================================================
\section{Расположение файла qnetmap.xml}

Файл qnetmap.xml должен находиться в том же месте, что и файлы плагинов.

%========================================================================
\section{Краткий справочник по элементам файла qnetmap.xml}

В следующей таблице приведет список элементов в файле qnetmap.xml. Некоторые элементы в файле (о чем будет сказано ниже в их описании) могут отсутствовать.

\begin{longtable}[c] 
% Устанавливаем ширину столбцов
{|m{0.2\textwidth}|m{0.75\textwidth}|} 
\caption{Список элементов в файле qnetmap.xml} 
\label{table:maintags} \\ 
\hline
\centering{\small{\textbf{Элемент}}} &
\centering{\small{\textbf{Описание}}} 
\endhead 
\hline

\raggedright{\tt QNetMap} & 
Элемент верхнего уровня, содержащий все необходимые теги. \\ 
\hline

\raggedright{\tt Http} & 
Элемент второго уровня, вложенный в элемент {\tt QNetMap}. 
Содержит произвольное количество наборов параметров http-соединений. \\ 
\hline

\raggedright{\tt HttpFields} & 
Элемент третьего уровня, вложенный в элемент {\tt Http}. 
Содержит набор параметров для конкретного http-соединения. \\ 
\hline

\raggedright{\tt TileMapAdapters} & 
Элемент второго уровня, вложенный в элемент {\tt QNetMap}. 
Содержит произвольное количество описаний источников карт. \\ 
\hline

\raggedright{\tt TileMapAdapter} & 
Элемент третьего уровня, вложенный в элемент {\tt TileMapAdapters}. 
Содержит описание конкретного источника карт. \\
\hline

\raggedright{\tt GeoParameters} & 
Элемент четвертого уровня, вложенный в элемент {\tt TileMapAdapter}. 
Содержит географические параметры источника карт. \\
\hline

\raggedright{\tt Projection} & 
Элемент пятого уровня, вложенный в элемент {\tt GeoParameters}. 
Содержит параметры проекции источника карт. \\
\hline

\raggedright{\tt Tiles} & 
Элемент пятого уровня, вложенный в элемент {\tt GeoParameters}.
Содержит параметры тайлов источника карт. \\
\hline

\raggedright{\tt Zooms} & 
Элемент пятого уровня, вложенный в элемент {\tt GeoParameters}.
Устанавливает границы масштабирования источника карт. \\
\hline

\raggedright{\tt Url} & 
Элемент четвертого уровня, вложенный в элемент {\tt TileMapAdapter}. 
Содержит шаблоны запроса тайлов источника карт. \\
\hline

\raggedright{\tt Host} & 
Элемент пятого уровня, вложенный в элемент {\tt Url}.
Содержит шаблон имени хоста. \\
\hline

\raggedright{\tt Query} & 
Элемент пятого уровня, вложенный в элемент {\tt Url}.
Содержит шаблон запроса тайлов. \\
\hline

\raggedright{\tt MapVersion} & 
Элемент четвертого уровня, вложенный в элемент {\tt TileMapAdapter}. 
Содержит номер версии карт по умолчанию и источник, из
которого можно получить номер последней версии. \\
\hline

\raggedright{\tt Source} & 
Элемент пятого уровня, вложенный в элемент {\tt MapVersion}.
Содержит данные об источнике номера последней версии карт. \\
\hline

\end{longtable}

%========================================================================
\section{Формат файла qnetmap.xml}

Элементы XML в файле qnetmap.xml начинаются с {\tt <} и заканчиваются символом {\tt />}.\\

Формат основного элемента:\\
<имя\_элемента~\lbrackимя\_атрибута="значение"\rbrack~\lbrackимя\_атрибута="значение"\rbrack~\ldots />\\

Пример:\\
<Zooms Minimum="1"\ Maximum="21"/>\\

В элементах, атрибутах и значениях атрибутов учитывается состояние регистра. Значения атрибутов должны заключаться в кавычки (").
Определение элемента может занимать несколько строк. Внутри определения элемента пробелы, возвраты каретки и символы табуляции игнорируются.\\

Пример:
\begin{description}
\item[] <Zooms\\
Minimum="1"\\ 
Maximum="21" />\\
\end{description}

Обязательное начало XML файла:\\
<?xml version="1.0"\ encoding="windows-1251"?>\\

Пробелы или переводы строки недопустимы в начале файла, обязательно указание кодировки "windows-1251".\\

Не допускаются знаки с ASCII-кодами 0-31, кроме табуляции и перевода строки. Необходимо кодировать следующие символы во всех текстовых полях в соответствующие им сущности:\\
\\*
"\ - \&quot;\\
\& - \&amp;\\
< - \&lt;\\
> - \&gt;\\
' - \&apos;\\

Комментарии можно добавлять в любом месте. Они отделяются с помощью символов "\ <!$-$$-$" и "$-$$-$>".\\

В следующем примере показано содержимое файла для "Open Street Map" :\\
\\*
<?xml version="1.0" encoding="UTF-8"?>
\begin{description}
\item[]<QNetMap>
\begin{description}
\item[]<TileMapAdapters>
\begin{description}
\item[]<TileMapAdapter Name="Open Street Map"\ Description="Open Street Map - схема"\  Type="Scheme"\ Transparency="Opaque"\ FolderName="openstreetmap"\ >
\begin{description}
\item[]<GeoParameters>\\
<Projection Type="Mercator"\ Basis="EPSG:3857"/>\\
<Tiles\ SizeX="256"\ SizeY="256"\ Numbering="Google"/>\\
<Zooms Minimum="0"\ Maximum="19"/>
\end{description}
</GeoParameters>
\begin{description}
\item[]<Url>\\
<Host Template="tile.openstreetmap.org"/>\\
<Query Template="/\%1/\%2/\%3.png"/>
\end{description}
</Url>
\end{description}
</TileMapAdapter>
\end{description}
</TileMapAdapters>
\end{description}
</QNetMap>\\

%========================================================================
\section{Перечень элементов файла qnetmap.xml}

%========================================================================
\subsection{Элемент QNetMap}

Элемент верхнего уровня. Этот элемент является обязательным. Все остальные элементы должны отображаться внутри этого элемента.\\

{\tt Синтаксис}\\
\\*
<QNetMap>\\
\ldots\\
</QNetMap>

%========================================================================
\subsection{Элемент Http}

Элемент второго уровня. Вложен в элемент {\tt QNetMap}. Этот элемент не является обязательным.\\

{\tt Синтаксис}\\
\\*
<Http>\\
<HttpFields \ldots />\\
\ldots\\
</Http>

%========================================================================
\subsection{Элемент HttpFields}

Элемент третьего уровня, описывающий конкретный источник карт. Вложен в элемент {\tt Http}. Этот элемент не является обязательным. Количество этих элементов не ограничено.\\

{\tt Синтаксис}\\
\\*
<HttpFields UserAgent="значение"\ />\\

{\tt Атрибуты}\\

\begin{longtable}[c] 
% Устанавливаем ширину столбцов
{|m{0.15\textwidth}|m{0.8\textwidth}|} 
\caption{Список атрибутов элемента HttpFields} 
\label{table:maintags} \\ 
\hline
\centering{\small{\textbf{Атрибут}}} &
\centering{\small{\textbf{Описание}}} 
\endhead 
\hline

\raggedright{\tt UserAgent} & 
Строка поля User-Agent http-протокола. Атрибут является обязательным. \\ 
\hline
\end{longtable}

%========================================================================
\subsection{Элемент TileMapAdapters}

Элемент второго уровня. Вложен в элемент {\tt QNetMap}. Этот элемент является обязательным.\\

{\tt Синтаксис}\\
\\*
<TileMapAdapters>\\
<TileMapAdapter \ldots >\\
\ldots\\
</TileMapAdapter>\\
\ldots\\
</TileMapAdapters>

%========================================================================
\subsection{Элемент TileMapAdapter}

Элемент третьего уровня, описывающий конкретный источник карт. Вложен в элемент {\tt TileMapAdapters}. Количество этих элементов не ограничено.\\

{\tt Синтаксис}\\
\\*
<TileMapAdapter Name="значение"\ Description="значение"\  Type="значение"\ Transparency="значение"\ FolderName="значение"\ Updatability="значение"\ >\\
\ldots\\
</TileMapAdapter>\\

{\tt Атрибуты}\\

\begin{longtable}[c] 
% Устанавливаем ширину столбцов
{|m{0.15\textwidth}|m{0.8\textwidth}|} 
\caption{Список атрибутов элемента TileMapAdapter} 
\label{table:maintags} \\ 
\hline
\centering{\small{\textbf{Атрибут}}} &
\centering{\small{\textbf{Описание}}} 
\endhead 
\hline

\raggedright{\tt Name} & 
Наименование карты, которое будет показано в меню выбора карт. Атрибут является обязательным. \\ 
\hline

\raggedright{\tt Description} & 
Краткое описание карты. Атрибут является обязательным. \\ 
\hline

\raggedright{\tt Type} & 
Тип карты. Возможные значения "Scheme"\ (схема)~|~"Satellite"\ (спутниковая)~|~"RoadMap"\ (дорожная сеть)~|~"Information"\ (информационная). Атрибут является обязательным. \\ 
\hline

\raggedright{\tt Transparency} & 
Прозрачность. Возможные значения "Transparent"\ (прозрачная)~|~"Opaque"\ (непрозрачная). . Атрибут не является обязательным. По умолчанию Transparency="Opaque"\ . \\ 
\hline

\raggedright{\tt FolderName} & 
Имя папки в хранилище тайлов. Должно быть уникальным. Если Updatability="Static"\ (или атрибут Updatability отсутствует), атрибут является обязательным. Иначе, атрибут не имеет смысла и должен отсутствовать. \\ 
\hline

\raggedright{\tt Updatability} & 
Обновляемость тайлов. Возможные значения "Static"\ (статичные)~|~"Dynamic"\ (регулярно обновляемые). Атрибут не является обязательным. По умолчанию Updatability="Static"\ . \\ 
\hline
\end{longtable}

%========================================================================
\subsection{Элемент GeoParameters}

Элемент четвертого уровня, содержащий географические параметры источника карт. Вложен в элемент {\tt TileMapAdapter} в единственном экземпляре.\\

{\tt Синтаксис}\\
\\*
<GeoParameters>\\
\ldots\\
</GeoParameters>\\

Атрибутов не имеет.

%========================================================================
\subsection{Элемент Projection}

Элемент пятого уровня, описывающий параметры проекции источника карт.
Вложен в элемент {\tt GeoParameters} в единственном экземпляре.  \\

{\tt Синтаксис}\\
\\*
<Projection Type="значение"\ Basis="значение"/>\\

{\tt Атрибуты}\\

Все атрибуты элемента являются обязательными.

\begin{longtable}[c] 
% Устанавливаем ширину столбцов
{|m{0.15\textwidth}|m{0.8\textwidth}|} 
\caption{Список атрибутов элемента Projection} 
\label{table:maintags} \\ 
\hline
\centering{\small{\textbf{Атрибут}}} &
\centering{\small{\textbf{Описание}}} 
\endhead 
\hline

\raggedright{\tt Type} & 
Тип проекции. Возможное значение одно "Mercator". \\ 
\hline

\raggedright{\tt Basis} & 
Код EPSG. Возможные значения "EPSG:900913"\ |~"EPSG:3857"\ (используются в Google Maps)~|~"EPSG:3395"\ (используется в Yandex Maps). \\ 
\hline
\end{longtable}

%========================================================================
\subsection{Элемент Tiles}

Элемент пятого уровня, описывающий параметры тайлов источника карт.
Вложен в элемент {\tt GeoParameters} в единственном экземпляре.  \\

{\tt Синтаксис}\\
\\*
<Tiles SizeX="значение"\ SizeY="значение"\ Numbering="значение"/>\\

{\tt Атрибуты}\\

Все атрибуты элемента являются обязательными.

\begin{longtable}[c] 
% Устанавливаем ширину столбцов
{|m{0.15\textwidth}|m{0.8\textwidth}|} 
\caption{Список атрибутов элемента Tiles} 
\label{table:maintags} \\ 
\hline
\centering{\small{\textbf{Атрибут}}} &
\centering{\small{\textbf{Описание}}} 
\endhead 
\hline

\raggedright{\tt SizeX} & 
Размер тайла в пикселах по оси X. Значение должно быть > 0. \\ 
\hline

\raggedright{\tt SizeY} & 
Размер тайла в пикселах по оси Y. Значение должно быть > 0. \\ 
\hline

\raggedright{\tt Numbering} & 
Нумерация тайлов. Возможные значения "00TopLeft"\ (Начало координат в верхнем левом углу, используется в Google Maps)~|~"00BottomLeft"\ (Начало координат в нижнем левом углу, используется в Navitel)~|~"Yahoo"\ (используется в Yahoo Maps). \\ 
\hline
\end{longtable}

%========================================================================
\subsection{Элемент Zooms}

Элемент пятого уровня, описывающий границы масштабирования источника карт.
Вложен в элемент {\tt GeoParameters} в единственном экземпляре.  \\

{\tt Синтаксис}\\
\\*
<Zooms Minimum="значение"\ Maximum="значение"\ Shift="значение"/>\\

{\tt Атрибуты}\\

Атрибуты элемента Minimum и Maximum являются обязательными.

\begin{longtable}[c] 
% Устанавливаем ширину столбцов
{|m{0.15\textwidth}|m{0.8\textwidth}|} 
\caption{Список атрибутов элемента Zooms} 
\label{table:maintags} \\ 
\hline
\centering{\small{\textbf{Атрибут}}} &
\centering{\small{\textbf{Описание}}} 
\endhead 
\hline

\raggedright{\tt Minimum} & 
Минимальный масштаб. Значение должно быть >= 0. \\ 
\hline

\raggedright{\tt Maximum} & 
Максимальный масштаб. Значение должно быть больше атрибута Minimum. \\ 
\hline

\raggedright{\tt Shift} & 
Сдвиг нумерации относительно нумерации Google Maps. \\ 
\hline
\end{longtable}

%========================================================================
\subsection{Элемент Url}

Элемент четвертого уровня, содержащий шаблоны запроса тайлов источника карт. Вложен в элемент {\tt TileMapAdapter} в единственном экземпляре.\\

{\tt Синтаксис}\\
\\*
<Url>\\
\ldots\\
</Url>\\

Атрибутов не имеет.

%========================================================================
\subsection{Элемент Host}

Элемент пятого уровня, содержащий шаблон имени хоста источника карт.
Вложен в элемент {\tt Url} в единственном экземпляре.  \\

{\tt Синтаксис}\\
\\*
<Host Template="значение"\ Minimum="значение"\ Maximum="значение"/>\\

{\tt Атрибуты}\\

Обязяательным является или один атрибут Template или все атрибуты вместе.

\begin{longtable}[c] 
% Устанавливаем ширину столбцов
{|m{0.15\textwidth}|m{0.8\textwidth}|} 
\caption{Список атрибутов элемента Host} 
\label{table:maintags} \\ 
\hline
\centering{\small{\textbf{Атрибут}}} &
\centering{\small{\textbf{Описание}}} 
\endhead 
\hline

\raggedright{\tt Template} & 
Шаблон имени хоста источника карт. Может содержать маркер \%1. Маркер при составлении запросов к источнику карт будет заменен на число или латинсий символ из диапазона, указанного в атрибутах Minimum и Maximum.\\ 
\hline

\raggedright{\tt Minimum} & 
Минимальный номер или латинский символ. Для номера значение должно быть >= 0. \\ 
\hline

\raggedright{\tt Maximum} & 
Максимальный номер или латинский символ. Значение должно быть больше атрибута Minimum. \\ 
\hline
\end{longtable}

%========================================================================
\subsection{Элемент Query}

Элемент пятого уровня, содержащий запроса тайлов источника карт, добавляемый к имени хоста. Вложен в элемент {\tt Url} в единственном экземпляре.  \\

{\tt Синтаксис}\\
\\*
<Query Template="значение" CoordinatesWidth="значение" ="значение"/>
\\

{\tt Атрибуты}\\

Атрибут Template является обязательным.

\begin{longtable}[c] 
% Устанавливаем ширину столбцов
{|m{0.2\textwidth}|m{0.75\textwidth}|} 
\caption{Список атрибутов элемента Query} 
\label{table:maintags} \\ 
\hline
\centering{\small{\textbf{Атрибут}}} &
\centering{\small{\textbf{Описание}}} 
\endhead 
\hline

\raggedright{\tt Template} & 
Шаблон запроса тайлов источника карт. Обязательно должен содержать три маркера \%1, \%2, \%3 или один маркер \%5. Маркер \%1 ставится вместо значение масштаба, маркер \%2 ставится вместо номера тайла по Х, маркер \%3 ставится вместо номера тайла по Y, маркер \%5 ставится вместо quadkey (номер тайла в бинарном дереве тайлов, как в visualearth.net). Может содержать маркер \%4, который ставится вместо номера версии карт.\\ 
\hline

\raggedright{\tt CoordinatesWidth} & 
Ширина поля, отводимого под координату (число с лидирующими нулями). Значение должно быть больше нуля. \\ 
\hline

\raggedright{\tt ZoomWidth} & 
Ширина поля, отводимого под масштаб (число с лидирующими нулями). Значение должно быть больше нуля. \\ 
\hline
\end{longtable}

%========================================================================
\subsection{Элемент MapVersion}

Необязательный элемент четвертого уровня, содержащий данные о номере версии карт. Вложен в элемент {\tt TileMapAdapter} в единственном экземпляре.  \\

{\tt Синтаксис}\\
\\*
<MapVersion Default="значение"\ >\\
\ldots\\
</MapVersion>\\

{\tt Атрибуты}\\

Атрибут Default является обязательным.

\begin{longtable}[c] 
% Устанавливаем ширину столбцов
{|m{0.15\textwidth}|m{0.8\textwidth}|} 
\caption{Список атрибутов элемента MapVersion} 
\label{table:maintags} \\ 
\hline
\centering{\small{\textbf{Атрибут}}} &
\centering{\small{\textbf{Описание}}} 
\endhead 
\hline

\raggedright{\tt Default} & 
Значение по умолчанию номера версии карт. Представляет из себя произвольный набор символов, соответствующий номеру карт соостветствующего источника. Подставляется вместо маркера \%4 элемента Query. Это значение действует до получения из источника карт номера текущей версии.\\ 
\hline
\end{longtable}

%========================================================================
\subsection{Элемент Source}

Необязательный элемент пятого уровня, содержащий данные для поиска номера версии карт.
Вложен в элемент {\tt MapVersion} в единственном экземпляре.  \\

{\tt Синтаксис}\\
\\*
<Source Url="значение"\ Prefix="значение"\ Postfix="значение"/>\\

{\tt Атрибуты}\\

Все атрибуты являются обязательными.

\begin{longtable}[c] 
% Устанавливаем ширину столбцов
{|m{0.15\textwidth}|m{0.8\textwidth}|} 
\caption{Список атрибутов элемента Source} 
\label{table:maintags} \\ 
\hline
\centering{\small{\textbf{Атрибут}}} &
\centering{\small{\textbf{Описание}}} 
\endhead 
\hline

\raggedright{\tt Url} & 
Url документа, из которого можно извлечь номер текущей версии карт.\\ 
\hline

\raggedright{\tt Prefix} & 
Строка, предваряющая номер версии карт. \\ 
\hline

\raggedright{\tt Postfix} & 
Строка после номера версии карт. \\ 
\hline
\end{longtable}

%========================================================================
\end{document}
